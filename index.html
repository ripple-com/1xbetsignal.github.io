<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator Full UI Clone</title>
    <style>
        /* =================================
           CSS: සම්පූර්ණ UI පෙනුම
           ================================= */
        :root {
            --dark-bg: #212529;
            --main-bg: #1a1e21; /* ප්‍රධාන පසුබිම */
            --bet-bg: #3C4146;
            --green: #00B100;
            --multiplier-color: #ffffff;
            --history-low: #6a1b9a;
            --history-medium: #cc00cc;
            --history-high: #ffc107;
            --text-color: #ffffff;
            --bet-placed-color: #6A1B9A;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #app-container {
            width: 100%;
            max-width: 600px; 
            background-color: var(--dark-bg);
        }

        /* ------------------ Header/History ------------------ */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: var(--main-bg);
            border-bottom: 1px solid #333;
        }
        #logo { color: #d10034; font-size: 1.5em; font-weight: bold; }
        #balance { color: var(--green); font-size: 1.1em; }

        #history-bar {
            padding: 8px 15px;
            background-color: #1a1e21; 
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            gap: 10px;
            border-bottom: 1px solid #333;
        }
        .result-chip {
            flex-shrink: 0;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            color: var(--text-color);
        }
        .color-low { background-color: var(--history-low); } 
        .color-medium { background-color: var(--history-medium); }
        .color-high { background-color: var(--history-high); } 
        

        /* ------------------ ප්‍රධාන ක්‍රීඩා ප්‍රදේශය (Canvas/UI) ------------------ */
        #game-area {
            position: relative;
            background-color: var(--main-bg); 
            border-bottom: 1px solid #333;
        }
        #gameCanvas {
            display: block;
            width: 100%;
            height: 300px;
        }
        #multiplier-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            font-weight: 900;
            color: var(--multiplier-color);
            transition: color 0.3s;
            z-index: 10;
        }
        .multiplier-playing { color: #CCC !important; }
        .multiplier-crashed { color: #FF0000 !important; }
        
        /* ඊළඟ වටය සඳහා කාල ගණකය */
        #countdown-timer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 900;
            color: #d10034;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            display: none; /* JS මගින් පෙන්වනු ඇත */
            z-index: 15;
        }
        /* Place Bets Text */
        .place-bets-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: #ccc;
            z-index: 10;
        }

        /* ------------------ ඔට්ටු පැනල (Betting Panels) ------------------ */
        #control-panel-container {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            gap: 10px;
        }

        .bet-panel {
            flex: 1;
            background-color: var(--bet-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        /* Auto Cash Out ක්ෂේත්‍රය */
        .auto-cashout-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #495057;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 5px;
        }
        .auto-cashout-group input {
            width: 40%;
            background: none;
            border: none;
            color: white;
            text-align: right;
            padding: 5px;
            font-size: 1em;
        }
        .auto-cashout-group label {
            font-size: 0.9em;
            color: #ccc;
        }

        /* පෙර තිබූ ඔට්ටු පාලක CSS මෙහි තබන්න */
        .bet-type-bar { /* ... */ }
        .bet-input-group { /* ... */ }
        .quick-bets { /* ... */ }
        .main-action-button { /* ... */ }
        /* ... (ඉතිරි පාලක CSS) ... */

        /* ------------------ සජීවී ඔට්ටු සහ සංඛ්‍යාලේඛන පැනලය ------------------ */
        #side-stats-container {
            background-color: var(--dark-bg);
            border-top: 1px solid #333;
        }
        #stats-tabs {
            display: flex;
            justify-content: space-around;
            background-color: #333;
            border-bottom: 1px solid #555;
        }
        .tab-button {
            flex: 1;
            padding: 10px;
            border: none;
            background-color: #333;
            color: #aaa;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .tab-button.active {
            background-color: var(--main-bg);
            color: var(--green);
            border-bottom: 2px solid var(--green);
        }

        #stats-content {
            height: 200px;
            overflow-y: auto;
            padding: 10px;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .stats-table th, .stats-table td {
            padding: 8px 5px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        .stats-table th {
            color: #ccc;
        }
        .stats-table tr:last-child td {
            border-bottom: none;
        }
        .cashout-x { color: var(--green); font-weight: bold; }
        
    </style>
</head>
<body>

    <div id="app-container">
        
        <div id="header">
            <div id="logo">Aviator</div>
            <div id="balance">1000.00 LKR ☰</div>
        </div>
        
        <div id="history-bar">
             <span class="result-chip color-low">1.04x</span>
             <span class="result-chip color-medium">4.24x</span>
             <span class="result-chip color-high">18.47x</span>
        </div>

        <div id="game-area">
            <canvas id="gameCanvas" width="600" height="300"></canvas> 
            <div id="multiplier-display">1.00x</div>
            <div id="countdown-timer">3</div>
        </div>

        <div id="control-panel-container">
            
            <div class="bet-panel">
                <div class="bet-type-bar">
                    <button>Bet</button>
                    <button>Auto</button>
                </div>
                
                <div class="auto-cashout-group">
                    <label>Auto Cash Out</label>
                    <input type="number" id="auto-cashout-1" value="1.00" min="1.00" step="0.1">
                </div>
                
                <div class="bet-input-group">
                    <button class="minus-btn" data-input-id="bet1-amount" data-step="1">-</button>
                    <input type="number" id="bet1-amount" value="20.00" min="1.00" step="1.00">
                    <button class="plus-btn" data-input-id="bet1-amount" data-step="1">+</button>
                </div>

                <div class="quick-bets">
                    <button class="quick-btn" data-amount="100">100</button>
                    <button class="quick-btn" data-amount="200">200</button>
                    <button class="quick-btn" data-amount="500">500</button>
                    <button class="quick-btn" data-amount="10000">10,000</button>
                </div>

                <button id="bet1-action" class="main-action-button">Bet 20.00 LKR</button>
            </div>

            <div class="bet-panel">
                <div class="bet-type-bar">
                    <button>Bet</button>
                    <button>Auto</button>
                </div>

                <div class="auto-cashout-group">
                    <label>Auto Cash Out</label>
                    <input type="number" id="auto-cashout-2" value="1.00" min="1.00" step="0.1">
                </div>

                <div class="bet-input-group">
                    <button class="minus-btn" data-input-id="bet2-amount" data-step="1">-</button>
                    <input type="number" id="bet2-amount" value="20.00" min="1.00" step="1.00">
                    <button class="plus-btn" data-input-id="bet2-amount" data-step="1">+</button>
                </div>

                <div class="quick-bets">
                    <button class="quick-btn" data-amount="100">100</button>
                    <button class="quick-btn" data-amount="200">200</button>
                    <button class="quick-btn" data-amount="500">500</button>
                    <button class="quick-btn" data-amount="10000">10,000</button>
                </div>

                <button id="bet2-action" class="main-action-button">Bet 20.00 LKR</button>
            </div>

        </div>
        
        <div id="side-stats-container">
            <div id="stats-tabs">
                <button class="tab-button active" data-tab="live">Live Bets</button>
                <button class="tab-button" data-tab="my">My Bets</button>
                <button class="tab-button" data-tab="top">Top Bets</button>
            </div>

            <div id="stats-content">
                <div id="live-bets-content" class="tab-pane active">
                    <table class="stats-table">
                        <thead>
                            <tr><th>User</th><th>Bet</th><th>Cash Out</th><th>Profit</th></tr>
                        </thead>
                        <tbody id="live-bets-body">
                            </tbody>
                    </table>
                </div>
                <div id="my-bets-content" class="tab-pane" style="display:none;">
                    <table class="stats-table">
                        <thead>
                            <tr><th>Time</th><th>Bet</th><th>Multiplier</th><th>Profit</th></tr>
                        </thead>
                        <tbody id="my-bets-body">
                           </tbody>
                    </table>
                </div>
                <div id="top-bets-content" class="tab-pane" style="display:none;">
                    <table class="stats-table">
                        <thead>
                            <tr><th>User</th><th>Time</th><th>Multiplier</th><th>Winnings</th></tr>
                        </thead>
                        <tbody>
                             <tr><td>...</td><td>...</td><td>123.50x</td><td>5,000</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ===================================
        // JavaScript: සම්පූර්ණ තර්කනය
        // ===================================
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const multiplierDisplay = document.getElementById('multiplier-display');
        const historyBar = document.getElementById('history-bar');
        const countdownTimer = document.getElementById('countdown-timer');

        const bet1Action = document.getElementById('bet1-action');
        const bet2Action = document.getElementById('bet2-action');
        const bet1Input = document.getElementById('bet1-amount');
        const bet2Input = document.getElementById('bet2-amount');
        const autoCashout1 = document.getElementById('auto-cashout-1');
        const autoCashout2 = document.getElementById('auto-cashout-2');
        const liveBetsBody = document.getElementById('live-bets-body');
        const myBetsBody = document.getElementById('my-bets-body');
        
        // ඔට්ටු තත්ත්වයන්
        let currentMultiplier = 1.00;
        let isPlaying = false;
        let crashPoint = 0;
        let startTime;
        let bet1Placed = false;
        let bet1CashedOut = false;
        let bet2Placed = false;
        let bet2CashedOut = false;
        let balance = 1000.00;
        const balanceDisplay = document.getElementById('balance');
        let roundEndTime;
        
        // ව්‍යාජ සජීවී ඔට්ටු දත්ත
        let liveBetsData = [];

        // ===================================
        // UI & History Functions
        // ===================================
        function updateBalance(amount) {
            balance += amount;
            balanceDisplay.textContent = `${balance.toFixed(2)} LKR ☰`;
        }
        // ... (getHistoryColorClass සහ addHistoryResult පෙර තිබූ පරිදිම) ...
        function getHistoryColorClass(multiplier) {
            if (multiplier < 2.00) return 'color-low';
            if (multiplier < 10.00) return 'color-medium';
            return 'color-high';
        }
        function addHistoryResult(multiplier) {
            const chip = document.createElement('span');
            chip.textContent = multiplier.toFixed(2) + 'x';
            chip.className = 'result-chip ' + getHistoryColorClass(multiplier);
            historyBar.prepend(chip);
            historyBar.scrollLeft = 0;
            if (historyBar.children.length > 30) {
                historyBar.removeChild(historyBar.lastChild);
            }
        }
        
        // සජීවී ඔට්ටු ලැයිස්තුව යාවත්කාලීන කිරීම
        function updateLiveBetsUI() {
            liveBetsBody.innerHTML = '';
            liveBetsData.forEach(bet => {
                const row = liveBetsBody.insertRow();
                row.insertCell().textContent = bet.user;
                row.insertCell().textContent = bet.amount.toFixed(2);
                
                const cashoutCell = row.insertCell();
                const profitCell = row.insertCell();

                if (isPlaying) {
                     if (bet.cashedOut) {
                        cashoutCell.innerHTML = `<span class="cashout-x">${bet.cashoutX.toFixed(2)}x</span>`;
                        profitCell.textContent = (bet.amount * bet.cashoutX - bet.amount).toFixed(2);
                        profitCell.style.color = 'var(--green)';
                     } else {
                        cashoutCell.textContent = '...';
                        profitCell.textContent = '...';
                     }
                } else {
                    if (bet.cashedOut) {
                        cashoutCell.innerHTML = `<span class="cashout-x">${bet.cashoutX.toFixed(2)}x</span>`;
                        profitCell.textContent = (bet.amount * bet.cashoutX).toFixed(2);
                        profitCell.style.color = 'var(--green)';
                    } else {
                        cashoutCell.textContent = '-';
                        profitCell.textContent = 'Lost';
                        profitCell.style.color = '#FF0000';
                    }
                }
            });
        }
        
        // මගේ ඔට්ටු ලැයිස්තුවට එකතු කිරීම
        function addMyBet(betAmount, multiplier, profit) {
            const row = myBetsBody.insertRow(0); // මුලටම එකතු කරන්න
            row.insertCell().textContent = new Date().toLocaleTimeString();
            row.insertCell().textContent = betAmount.toFixed(2);
            
            const multiplierCell = row.insertCell();
            multiplierCell.textContent = multiplier ? multiplier.toFixed(2) + 'x' : 'Lost';
            multiplierCell.style.color = multiplier ? 'var(--green)' : '#FF0000';

            const profitCell = row.insertCell();
            profitCell.textContent = profit ? profit.toFixed(2) : `-${betAmount.toFixed(2)}`;
            profitCell.style.color = profit ? 'var(--green)' : '#FF0000';
        }

        function updateBetButton(betNumber) {
            // ... (පෙර තිබූ පරිදිම) ...
            const betAction = (betNumber === 1) ? bet1Action : bet2Action;
            const betInput = (betNumber === 1) ? bet1Input : bet2Input;
            const amount = parseFloat(betInput.value);

            if (betNumber === 1 ? bet1Placed : bet2Placed) {
                if (betNumber === 1 ? bet1CashedOut : bet2CashedOut) {
                    betAction.textContent = `CASHOUTED ${betNumber === 1 ? bet1CashoutX : bet2CashoutX}x`;
                    betAction.style.backgroundColor = 'var(--bet-placed-color)';
                    betAction.disabled = true;
                } else if (isPlaying) {
                    betAction.textContent = `Cash Out x${currentMultiplier.toFixed(2)}`;
                    betAction.style.backgroundColor = 'var(--green)';
                    betAction.disabled = false;
                } else {
                     betAction.textContent = `Bet Placed ${amount.toFixed(2)}`;
                     betAction.style.backgroundColor = 'var(--bet-placed-color)';
                     betAction.disabled = true;
                }
            } else {
                betAction.textContent = `Bet ${amount.toFixed(2)} LKR`;
                betAction.style.backgroundColor = 'var(--green)';
                betAction.disabled = false;
            }
        }
        
        // ටැබ් වෙනස් කිරීම
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.tab-pane').forEach(pane => pane.style.display = 'none');
                document.getElementById(this.getAttribute('data-tab') + '-bets-content').style.display = 'block';
            });
        });

        // ===================================
        // Game Logic Functions
        // ===================================
        function calculateMultiplier(timeElapsed) {
            if (timeElapsed < 1000) return 1.00 + timeElapsed / 1000 * 0.1; 
            return 1.1 + Math.pow(timeElapsed / 1000, 1.5) * 0.5;
        }

        // ... (drawGraph ශ්‍රිතය පෙර තිබූ පරිදිම - Canvas ඇඳීම) ...

        function drawGraph() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ... (Canvas ග්‍රිඩ් තර්කනය මෙහිදී ඇතුළත් වේ) ...
            const MAX_MULTIPLIER_VISIBLE = 10;
            const x_coord = (performance.now() - startTime) / 15000 * canvas.width; // x අක්ෂය
            const y_norm = Math.log10(currentMultiplier) / Math.log10(MAX_MULTIPLIER_VISIBLE); 
            const y_coord = canvas.height - (y_norm * canvas.height * 0.9 + canvas.height * 0.1); 

            // ග්‍රිඩ් ඇඳීම
            ctx.strokeStyle = '#333'; ctx.lineWidth = 1;
            for (let i = 1; i < 10; i++) { ctx.beginPath(); ctx.moveTo(i * (canvas.width / 10), 0); ctx.lineTo(i * (canvas.width / 10), canvas.height); ctx.stroke(); }
            for (let i = 1; i < 5; i++) { const y_grid_norm = Math.log10(i * 2) / Math.log10(MAX_MULTIPLIER_VISIBLE); const y_grid = canvas.height - (y_grid_norm * canvas.height * 0.9 + canvas.height * 0.1); ctx.beginPath(); ctx.moveTo(0, y_grid); ctx.lineTo(canvas.width, y_grid); ctx.stroke(); }
            // වක්‍රය සහ ලක්ෂ්‍යය
            if (currentMultiplier > 1.00 && isPlaying) {
                ctx.strokeStyle = '#00FF00'; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(0, canvas.height); ctx.lineTo(x_coord, y_coord); ctx.stroke();
                ctx.fillStyle = '#D10034'; ctx.beginPath(); ctx.arc(x_coord, y_coord, 5, 0, Math.PI * 2); ctx.fill();
            }

            updateBetButton(1);
            updateBetButton(2);
            updateLiveBetsUI(); // සෑම රාමුවකම Live Bets යාවත්කාලීන කිරීම
        }

        function checkAutoCashOut() {
            const m = currentMultiplier;

            if (bet1Placed && !bet1CashedOut && m >= parseFloat(autoCashout1.value)) {
                cashOut(1);
            }
            if (bet2Placed && !bet2CashedOut && m >= parseFloat(autoCashout2.value)) {
                cashOut(2);
            }
            
            // Live Bets හිදී ද ඔටෝ Cash Out අනුකරණය
            liveBetsData.forEach(bet => {
                if (!bet.cashedOut && m >= bet.autoX) {
                    bet.cashedOut = true;
                    bet.cashoutX = m;
                }
            });
        }

        function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            
            if (isPlaying) {
                const timeElapsed = timestamp - startTime;
                currentMultiplier = calculateMultiplier(timeElapsed);
                
                checkAutoCashOut(); // ඔටෝ Cash Out පරීක්ෂා කරන්න
                
                if (currentMultiplier >= crashPoint) {
                    crashGame();
                }
                
                multiplierDisplay.textContent = currentMultiplier.toFixed(2) + 'x';
            } else if (timestamp < roundEndTime) {
                // Countdown Timer පෙන්වන්න
                const remaining = Math.ceil((roundEndTime - timestamp) / 1000);
                countdownTimer.textContent = remaining;
                countdownTimer.style.display = 'block';
                
                // ඔට්ටු ඇල්ලීමේ කාලය අවසන් වූ විට
                if (remaining <= 0) {
                     countdownTimer.style.display = 'none';
                     startGame();
                }
            } else {
                 countdownTimer.style.display = 'none';
                 multiplierDisplay.textContent = '1.00x'; // තවමත් වටය ආරම්භ වී නැත
            }
            
            drawGraph();
            requestAnimationFrame(animate);
        }

        function startGame() {
            isPlaying = true;
            currentMultiplier = 1.00;
            crashPoint = 1.01 + Math.random() * 8.99; 
            startTime = performance.now();
            roundEndTime = 0; // වටය ආරම්භ වූ පසු ටයිමරය නවත්වන්න
            
            multiplierDisplay.className = 'multiplier-playing'; 
            
            // ව්‍යාජ Live Bets උත්පාදනය (සෑම වටයකටම නව)
            liveBetsData = generateDummyLiveBets();
            
            updateBetButton(1); updateBetButton(2);
        }

        function cashOut(betNumber) {
            if (!isPlaying || (betNumber === 1 ? bet1CashedOut : bet2CashedOut)) return;

            const betInput = (betNumber === 1) ? bet1Input : bet2Input;
            const betAmount = parseFloat(betInput.value);
            const cashoutX = currentMultiplier;
            const winnings = betAmount * cashoutX;

            updateBalance(winnings);
            
            if (betNumber === 1) {
                bet1CashedOut = true;
                bet1CashoutX = cashoutX;
                addMyBet(betAmount, cashoutX, winnings);
            } else {
                bet2CashedOut = true;
                bet2CashoutX = cashoutX;
                addMyBet(betAmount, cashoutX, winnings);
            }
            updateBetButton(betNumber);
        }

        function crashGame() {
            isPlaying = false;
            
            const finalMultiplier = currentMultiplier; 
            addHistoryResult(finalMultiplier);
            
            multiplierDisplay.textContent = finalMultiplier.toFixed(2) + 'x';
            multiplierDisplay.className = 'multiplier-crashed'; 

            if (bet1Placed && !bet1CashedOut) {
                bet1Action.textContent = 'Lost'; bet1Action.style.backgroundColor = '#FF0000';
                addMyBet(parseFloat(bet1Input.value), null, null);
            }
            if (bet2Placed && !bet2CashedOut) {
                bet2Action.textContent = 'Lost'; bet2Action.style.backgroundColor = '#FF0000';
                addMyBet(parseFloat(bet2Input.value), null, null);
            }
            
            // ඊළඟ වටය සඳහා කවුන්ට් ඩවුන් ආරම්භ කරන්න
            roundEndTime = performance.now() + 5000; // තත්පර 5 ක කවුන්ට් ඩවුන්
            setTimeout(resetRound, 5000); 
        }

        function resetRound() {
            bet1Placed = false; bet1CashedOut = false; bet2Placed = false; bet2CashedOut = false;
            bet1CashoutX = 0; bet2CashoutX = 0;
            currentMultiplier = 1.00;
            
            multiplierDisplay.textContent = 'Place Your Bets';
            multiplierDisplay.className = '';
            
            updateBetButton(1); updateBetButton(2);
        }

        // ව්‍යාජ දත්ත උත්පාදනය
        function generateDummyLiveBets() {
            const bets = [];
            for (let i = 0; i < 10 + Math.floor(Math.random() * 10); i++) {
                bets.push({
                    user: `User${i + 1}`,
                    amount: 100 + Math.floor(Math.random() * 1000),
                    cashedOut: Math.random() < 0.3, // 30% දැනටමත් cashed out
                    cashoutX: 1.01 + Math.random() * 5,
                    autoX: 1.01 + Math.random() * 10 
                });
            }
            return bets.sort((a, b) => b.amount - a.amount); // මුදල අනුව වර්ග කරන්න
        }

        // ===================================
        // Event Listeners (Betting)
        // ===================================
        
        // ... (Quick Bets, +/-, සහ Bet Actions කලින් කේතයේ තිබූ පරිදිම) ...

        // ආරම්භක සැකසුම්
        addHistoryResult(1.23); addHistoryResult(4.55); addHistoryResult(18.08);
        updateBalance(0);
        
        // සජීවීකරණය ආරම්භ කරන්න (කවුන්ට් ඩවුන් පටන් ගනියි)
        animate(performance.now());
        roundEndTime = performance.now() + 5000; // ආරම්භයේදී තත්පර 5ක ටයිමරය
        resetRound(); // ටයිමරය ආරම්භ කිරීමට

    </script>
</body>
</html>